# This is a UNIX conf file that contains ALL information relating to
# the HAFS basin-focused global-nesting configuration with coupling to
# the HYCOM tropical channel domain.
#
[config]
# Specify the domain center Latitude and Longitude
NHRS=168
domlat=0.0
domlon=-60.0
# Same as domlat and domlon but vitals formatted 
vitalsdomlat=00N
vitalsdomlon=600W

# HAFS launcher requires vitals and a storm.
# This is a default minimum vitals file for a fake storm.
# The format of the missing value fields was based on the log
# output returned when running the launcher after the vitals have 
# been "cleaned" up. That is, if  you enter the fields as all -999 values, 
# the "cleaned" output is returned. In essence I'm treating the vitals 
# module as a factory in the sense that it knows the correct format.
# NHC 00L FAKE 20120710 0000 250N 0800W -99 -99 -999 -999 -099 -9 -99 -999 -999 -999 -999 M
# fakestormid is a config option set in the launcher and is the 
# last storm id in the list of storms.
fakestormid=00L
fakestormname=NATL
fakestormorg=NHC
fakestorm_vitals={fakestormorg} {fakestormid} {fakestormname} {YMD} {HH}{min} {vitalsdomlat} {vitalsdomlon} -99 -99 -999 -999 -099 -9 -99 -999 -999 -999 -999 M

#vcoord_file_target_grid={PARMhafs}/chgres/hafs_hyblev.l{LEVS}.txt
vcoord_file_target_grid={PARMhafs}/levels/hafs_hyblev.l{LEVS}.txt

[dir]
#PARMforecast={PARMhafs}/forecast/globnest_NATLtropicalchannel_edmftke_hurricane_L75
PARMforecast={PARMhafs}/forecast/globnest
# #COMgfs=/scratch1/NCEPDEV/hwrf/noscrub/input/hafs-input/
# COMgfs=/work/noaa/aoml-hafs1/ahazelto/hafs-input/COMGFS
# #COMgfs=/work/noaa/hwrf/noscrub/hafs-input/COMGFS

[grid]
CASE=C768            ;; FV3 resolution
LEVS=76              ;; Model vertical levels: 65
gtype=nest           ;; grid type: uniform, stretch, nest, or regional
# If gridfixdir is provided and the dir exists, then use the pre-generated static grid fix files under gridfixdir
#gridfixdir={FIXhafs}/fix_fv3/{CASE}_globnest_static
gridfixdir=/let/hafs_grid/generate/grid
# #gridfixdir=/scratch2/NAGAPE/aoml-hafs1/Andrew.Hazelton/HAFSV0.B_testing_CCPP/HAFS/grids/hafs_globnest_static_2019
# #gridfixdir=/scratch2/NAGAPE/aoml-hafs1/Andrew.Hazelton/HAFSV0.1B_2020_RT/HAFS/grids/C768r10n4_Atlantic_3km_nostretch_tropics_2020
# #gridfixdir=/lfs4/HFIP/hur-aoml/Andrew.Hazelton/HAFS2020_multinest/HAFS/grids/C768r10n4_Atlantic_3km_nostretch_tropics_2020
# gridfixdir=/lfs4/HFIP/hur-aoml/Andrew.Hazelton/HAFS/grids/C768r10n4_MultiNest_3km_nostretch_tropics
# Otherwise, will generate the model grid according to the following grid parameters
# Need for grid types: stretch, nest and regional
stretch_fac=1.0001    ;; Stretching factor for the grid
target_lon={domlon}  ;; center longitude of the highest resolution tile
target_lat={domlat}  ;; center latitude of the highest resolution tile
# Need for grid types: nest and regional
nest_grids=1
parent_grid_num=1
parent_tile=6
refine_ratio=4       ;; Specify the refinement ratio for nest grid
istart_nest=293
jstart_nest=37
iend_nest=1480
jend_nest=750

[prodglb]
#atmos_tracker_remap_weight=/scratch2/NAGAPE/aoml-hafs1/Andrew.Hazelton/HAFSV0.1B_2020_RT/HAFS/grids/C768r10n4_Atlantic_3km_nostretch_tropics_2020/remap_file_c768r10n4_Atlantic_3km_nostretch_tropics_2020_2880x1440.nc
# atmos_tracker_remap_weight=/lfs4/HFIP/hur-aoml/Andrew.Hazelton/HAFS2020_multinest/HAFS/grids/C768r10n4_Atlantic_3km_nostretch_tropics_2020/remap_file_c768r10n4_Atlantic_3km_nostretch_tropics_2020_2880x1440.nc
atmos_tracker_remap_weight=/lfs4/HFIP/hur-aoml/Andrew.Hazelton/HAFS/grids/C768r10n4_MultiNest_3km_nostretch_tropics/
prodglb_nlon=2880
prodglb_nlat=1440

[forecast]
# TEDMF + turn off nsst
ccpp_suite_glob=HAFS_v0_gfdlmp_tedmf_nonsst
ccpp_suite_nest=HAFS_v0_gfdlmp_tedmf_nonsst
# HEDMF + turn off nsst
#ccpp_suite_glob=HAFS_v0_gfdlmp_nonsst
#ccpp_suite_nest=HAFS_v0_gfdlmp_nonsst

# For the global domain if it is a global or global-nesting experiment
# glob_layoutx=8
# glob_layouty=12
# glob_npx=769
# glob_npy=769
glob_layoutx=10
glob_layouty=12
glob_npx=769
glob_npy=769

# For the nested or regional standalone domain
#zzlayoutx=48
#zzlayouty=32
# layoutx=36
# layouty=34
# npx=2377
# npy=1429
# npz=75
layoutx=36
layouty=34
npx=2377
npy=1429
npz=75

# write_groups=3
# #write_tasks_per_group=80
# write_tasks_per_group=48
quilting=.true.
write_groups=1
write_tasks_per_group=96
output_grid=regional_latlon
output_grid_cen_lon=-69.0         ;; central longitude
output_grid_cen_lat=21.5          ;; central latitude
output_grid_lon_span=81.0         ;; output domain span for longitude in regular latlon coordinate system (in degrees)
output_grid_lat_span=51.0         ;; output domain span for latitude in regular latlon coordinate system (in degrees)
output_grid_dlon=0.03             ;; output grid spacing dlon . . . .
output_grid_dlat=0.03             ;; output grid spacing dlat . . . .

[rocotostr]
FORECAST_RESOURCES=FORECAST_RESOURCES_globnest_6x{forecast/glob_layoutx}x{forecast/glob_layouty}_{forecast/layoutx}x{forecast/layouty}io{forecast/write_groups}x{forecast/write_tasks_per_group}_ocn{forecast/ocean_tasks}_omp2


# Lew.Gramer@noaa.gov, 2021-04-06: All of the following copied from /work/noaa/aoml-hafs1/lgramer/src/hafs_glob_cpl3/parm/hafs_global_only_trop_ocn.conf, lines 76 onward
[dir]
FIXhycom={FIXhafs}/fix_hycom
PARMhycom={PARMhafs}/hycom/regional  ;; hycom parameter files

[config]
run_ocean=yes
ocean_model=hycom

CASE_ROOT={config/case_root}

[forecast]
# Choose nstf_name=0,0,0,0,0
nstf_n1=0
nstf_n2=0
nstf_n3=0
nstf_n4=0
nstf_n5=0

# Ocean coupling related options. Only useful when run_ocean=yes
# When run_ocean=yes, then the following options are available for cpl_ocean
# 0, run ocean model side by side (no coupling)
# 1, direct coupling through the nearest point regridding method
# 2, direct coupling through the bilinear regridding method
# 3, CMEPS based coupling through the bilinear regridding method
#cpl_ocean=3
# Lew.Gramer@noaa.gov 2021-05-21: CMEPS not currently useable for nested grid (no corner coordinates)
cpl_ocean=2
cpl_dt=360  ;; coupling time step in seconds
#ocean_tasks=120 ;; Number of PEs for the OCN component
#ocean_tasks=60 ;; Number of PEs for the OCN component
ocean_tasks=240 ;; Number of PEs for the OCN component
ocean_start_dtg=auto ;; epoch day since hycom_epoch=datetime.datetime(1900,12,31,0,0,0), e.g., 43340.00000
merge_import=.true.

[exe]
wgrib2={ENV[WGRIB2]}
cnvgrib={ENV[CNVGRIB]}

wgrib={ENV[WGRIB]}
grbindex={ENV[GRIBINDEX]}

copygb2={ENV[COPYGB2]}
grb2index={ENV[GRB2INDEX]}

hafs_get_rtofs={EXEChafs}/hafs_get_rtofs.x
hafs_rtofs_subregion={EXEChafs}/hafs_rtofs_subregion.x
hafs_gfs2ofs2={EXEChafs}/hafs_gfs2ofs2.x
hafs_timeinterp_forcing={EXEChafs}/hafs_timeinterp_forcing.x
hafs_archv2restart={EXEChafs}/hafs_archv2restart.x
hafs_restart2restart={EXEChafs}/hafs_restart2restart.x
hafs_archv2data3z={EXEChafs}/hafs_archv2data3z.x
hafs_archv2data2d={EXEChafs}/hafs_archv2data2d.x
hafs_archv3z2nc={EXEChafs}/hafs_archv3z2nc.x
hafs_gfs2ofsinputs.py={USHhafs}/hafs_gfs2ofsinputs.py

[hycominit1]
scrub=no              ;; Override global scrubbing option for hycom init
catalog={input_catalog}
btype=0			;; HYCOM tropic band

RTOFS_HIST=/dev/null  ;; RTOFS .a and .b file locations of historical RTOFS
RTOFS_FCST=/dev/null  ;; RTOFS .a and .b file locations of real-time RTOFS
RTOFS_TAR=/dev/null   ;; RTOFS .a.tgz and .b file locations
RTOFS_TAR={rtofs}/rtofs.{aYMD}   ;; RTOFS .a.tgz and .b file locations
RTOFS_STAGE={WORKhafs}/hycominit1/RTOFSDIR ;; RTOFS staging/linking area
#net yetRTOFS_STAGE={rtofs}/rtofs.{aYMD};; RTOFS staging/linking area

bools=hycombools      ;; Section with YES/NO variables for shell programs
strings=hycomstrings  ;; Section with string variables for shell programs

## Output restart files; should contain RUNmodIDout and ab vars
restart_outR={com}/{out_prefix}.{RUNmodIDout}.spin_restart.{ab}
## Output restart R files; should contain RUNmodIDout and ab vars
restart_out={com}/{out_prefix}.{RUNmodIDout}.restart.{ab}
## Output spin files; should contain RUNmodIDout and ab vars
spin_archv={com}/{out_prefix}.spin_archv.{ab}

## Enable river adjustment in HYCOM initialization?
adjust_river=0

## Enable temperature adjustment in HYCOM initialization?
adjust_temp=0

## Interval in hours between forcing in the 126hr forecast mode
forecast_forcing_interval=3

atmos1_dataset=gdas1      ;; Dataset for global atmospheric surface data before time 0
atmos1_flux=gdas1_sfluxgrb ;; Item for atmospheric flux data before time 0
atmos1_grid=gdas1_gribA   ;; Item for atmospheric air data before time 0
atmos2_dataset=gfs        ;; Dataset for global atmospheric surface data after time 0
atmos2_flux=gfs_sfluxgrb  ;; Item for atmospheric flux data after time 0
atmos2_grid=gfs_gribA     ;; Item for atmospheric air data after time 0
ocean_dataset=rtofs       ;; Dataset for global ocean archv data
ocean_fcst=rtofs_fcst     ;; Item for ocean data after analysis time
ocean_past=rtofs_past     ;; Item for ocean data before the analysis time
ocean_now=rtofs_now       ;; Item for ocean data at the analysis time
ocean_rst=rtofs_rst       ;; Item for ocean restart files
ocean_dataset_stage=rtofsstage       ;; Dataset for global ocean archv data (staged)
ocean_fcst_name=rtofs_fcst_name     ;; Item for ocean data after analysis time
ocean_past_name=rtofs_past_name     ;; Item for ocean data before the analysis time
ocean_now_name=rtofs_now_name       ;; Item for ocean data at the analysis time
ocean_rst_name=rtofs_rst_name       ;; Item for ocean restart files

[hycominit2]
scrub=no              ;; Override global scrubbing option for hycom init
catalog={input_catalog}
btype=0 		;; htrop_basin

bools=hycombools      ;; Section with YES/NO variables for shell programs
strings=hycomstrings  ;; Section with string variables for shell programs

## Interval in hours between forcing in the 126hr forecast mode
forecast_forcing_interval=3

atmos1_dataset=gdas1      ;; Dataset for global atmospheric surface data before time 0
atmos1_flux=gdas1_sfluxgrb ;; Item for atmospheric flux data before time 0
atmos1_grid=gdas1_gribA   ;; Item for atmospheric air data before time 0
atmos2_dataset=gfs        ;; Dataset for global atmospheric surface data after time 0
atmos2_flux=gfs_sfluxgrb  ;; Item for atmospheric flux data after time 0
atmos2_grid=gfs_gribA     ;; Item for atmospheric air data after time 0

## Configuration for the ocean_post job
[hycompost]
scrub=no              ;; Override global scrubbing option for hycom init

bools=hycombools     ;; Section with YES/NO variables for shell programs
strings=hycomstrings ;; Section with string variables for shell programs

## This section contains YES/NO variables and values which will be set
## as environment variables in the shell programs.
#
# The hycombools section is filled with ENV_VAR=value entries.  Each
# ENV_VAR will be set to the boolean version of the value.  Values are
# converted to Python booleans and then to the strings YES or NO.  All
# environment variables must be valid shell and Python variable names.
[hycombools]
RUN_OCEAN={run_ocean}
RUN_WAVE={run_wave}

## This section contains variables and string values which will be set
## as environment variables in the shell programs.
#
# The hycomstrings section is filled with ENV_VAR=value entries.  The
# ENV_VAR will be set to the value, unmodified.  All environment
# variables must be valid shell and Python variable names.  The
# strings must be single line strings (no end-of-line characters) that
# are expressable in both shell and Python.
#
# @note The special RTOFSDIR variable is set independently based on
# the hafs.hycom.HYCOMInit.find_rtofs_data() function.
[hycomstrings]
out_prefix={config/out_prefix}
out_prefix_nodate={config/out_prefix_nodate}
FORECAST_DIR={dir/WORKhafs}/runwrf
OCEAN_MODEL={ocean_model}
WAVE_MODEL={wave_model}
YMDH={config/YMDH}
stormlabel={config/stormlabel}
STORM={vit[stormname]}
STID={vit[stormid3]}
basin2={vit[pubbasin2]}
USHhafs={dir/USHhafs}
FIXhafs={dir/FIXhafs}
PARMhafs={dir/PARMhafs}
EXEChafs={dir/EXEChafs}
COMhafs={config/com}
WORKhafs={dir/WORKhafs}
CASE_ROOT={config/case_root}
